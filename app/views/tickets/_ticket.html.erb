<div id="<%= dom_id ticket %>">
  <div class="row">
    <div class="col-9">
      <div class="m-2">
        <span class="fs-6 text-muted"><%= ticket.identifier %></span>
        <h4><%= ticket.title %></h4>

        <p>
          <%= markdown(ticket.content) %>
        </p>

        <hr/>

        <h5>Kommentare</h5>
        <%= turbo_stream_from dom_id(ticket, :comments) %>
        <%= turbo_frame_tag dom_id(ticket, :comments) do %>
          <%= render @ticket.comments %>
        <% end %>
        <%= turbo_frame_tag 'new_comment' do %>
          <%= link_to 'Neuer Kommentar', new_comment_path(ticket_id: @ticket) %>
        <% end %>
      </div>
    </div>
    <div class="col-3">
      <div class="m-2 p-2" style="background-color: #f9f9f9; border-radius: 3px; border: 1px solid #f0f0f0;">
        <p>
          <%= status_label(ticket) %>
          <%= priority_label(ticket) %>
        </p>

        <p>
          <% for tag in ticket.tags %>
            <span class="badge rounded-pill bg-secondary"><%= tag.name %></span>
          <% end %>
        </p>

        <div class="btn-group btn-group-vertical btn-group-sm" style="width: 100%;">
          <% if can?(:update, @ticket) %>
            <% if ticket.status.new? %>
              <%= link_to "Start", ticket_url(@ticket, { ticket: { status: :in_progress } }), class: 'btn btn-sm btn-outline-primary', 'data-turbo-method' => :patch %>
            <% end %>
            <% if ticket.status.in_progress? %>
              <%= link_to "Block", ticket_url(@ticket, { ticket: { status: :blocked } }), class: 'btn btn-sm btn-outline-warning', 'data-turbo-method' => :patch %>
              <%= link_to "Close", ticket_url(@ticket, { ticket: { status: :done } }), class: 'btn btn-sm btn-outline-success', 'data-turbo-method' => :patch %>
            <% end %>
            <% if ticket.status.blocked? %>
              <%= link_to "Start", ticket_url(@ticket, { ticket: { status: :blocked } }), class: 'btn btn-sm btn-outline-warning', 'data-turbo-method' => :patch %>
              <%= link_to "Close", ticket_url(@ticket, { ticket: { status: :done } }), class: 'btn btn-sm btn-outline-success', 'data-turbo-method' => :patch %>
            <% end %>
            <%= link_to t('edit'), edit_ticket_path(@ticket), class: 'btn btn-outline-secondary' %>
            <% if @ticket.assignee != current_user %>
              <%= link_to t('assign_to_me'), mine_ticket_path(@ticket), class: 'btn btn-outline-secondary', 'data-turbo-method' => :post %>
            <% end %>
          <% end %>
        </div>
        <p>
          <strong>Kunden-Projekt:</strong>
          <%= ticket.customer_project.name %>
        </p>

        <p>
          <strong>Creator:</strong>
          <%= ticket.creator.name %>
        </p>

        <p>
          <strong>Assignee:</strong>
          <% if ticket.assignee.present? %>
            <%= ticket.assignee.name %>
          <% else %>
            None
          <% end %>
        </p>


        <div>

        </div>
      </div>
    </div>
  </div>

</div>
